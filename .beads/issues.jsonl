{"id":"beethoven-78q","title":"Feature: Audio-Only Lesson Mode - Add option to run lessons with audio only (no avatar video)","description":"## Summary\n\nAdd an explicit 'audioOnly' mode for lessons that uses TTS audio with a static avatar image instead of rendering the Beyond Presence video avatar. This mode can be selected when creating lessons to:\n- Save on Beyond Presence API costs\n- Work when avatar video quota is exceeded\n- Provide a lighter-weight lesson experience\n\n## Background\n\nThe Python agent already has audio-only fallback code (lines 1284-1447 in apps/agent/main.py) that activates when Beyond Presence fails (quota exceeded, auth error, rate limited, etc.). This feature request is to make audio-only mode an intentional, configurable option rather than just a fallback.\n\n## Implementation Tasks\n\n### 1. Schema Updates (convex/schema.ts)\n- Add `audioOnly: v.optional(v.boolean())` to `structuredLessons` table\n- Add `audioOnly: v.optional(v.boolean())` to `sessions` table\n\n### 2. Session Creation Updates (convex/sessions.ts)\n- Modify `createFromStructuredLesson` to pass through `audioOnly` flag to session\n- Ensure `createSession` accepts optional `audioOnly` parameter\n\n### 3. Admin UI Updates (app/(dashboard)/admin/lessons/page.tsx or related)\n- Add toggle/checkbox for \"Audio Only Mode\" when creating a structured lesson\n- Include tooltip explaining: \"Uses TTS audio with static avatar image instead of video avatar. Saves API costs.\"\n\n### 4. Frontend Lesson Room Updates\n- Modify lesson room component to check session.audioOnly flag\n- When audioOnly=true:\n  - Display static avatar image (from avatar.appearance.avatarImage) instead of video track\n  - Hide/disable avatar video track subscription\n  - TTS audio still plays normally\n- Reference existing components:\n  - components/lesson/lesson-room.tsx\n  - components/lesson/teaching-room.tsx\n\n### 5. Python Agent Updates (apps/agent/main.py)\n- Read `audioOnly` flag from session data (fetched via Convex client)\n- When audioOnly=true:\n  - Skip Beyond Presence avatar initialization entirely (don't even attempt)\n  - Set `audio_only_mode = True` at the start\n  - Use existing audio-only code path\n- This avoids wasting API calls and reduces startup latency\n\n## Acceptance Criteria\n\n- [ ] Admin can toggle \"Audio Only\" when creating a structured lesson\n- [ ] When audioOnly lesson is started, frontend shows static avatar image\n- [ ] TTS audio plays normally in audioOnly mode\n- [ ] Python agent skips avatar video initialization for audioOnly sessions\n- [ ] Existing fallback behavior still works when avatar fails unexpectedly\n- [ ] No regression to normal avatar video lessons\n\n## Technical Notes\n\n- Avatar static images are stored in `avatar.appearance.avatarImage` field\n- The existing `audio_only_mode` variable in main.py should be set based on session config\n- Session data is already fetched via ConvexClient in the agent\n- Consider adding visual indicator in lesson UI showing \"Audio Only Mode\" to student\n\n## Related Files\n\n- `/Users/tomas/apps/beethoven/convex/schema.ts` - Database schema\n- `/Users/tomas/apps/beethoven/convex/sessions.ts` - Session mutations/queries\n- `/Users/tomas/apps/beethoven/apps/agent/main.py` - Python agent (lines 1284-1447 for existing fallback)\n- `/Users/tomas/apps/beethoven/components/lesson/lesson-room.tsx` - Frontend lesson UI\n- `/Users/tomas/apps/beethoven/components/lesson/teaching-room.tsx` - Teaching room component\n\n## Out of Scope\n\n- Automatic switching between video and audio-only based on quota\n- Per-session toggle (only per-lesson configuration for now)\n- Audio-only for quick practice or free conversation (only structured lessons)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T17:43:48.668012+01:00","created_by":"tomas","updated_at":"2026-01-04T17:43:48.668012+01:00","labels":["area:agent","area:frontend","area:lessons","cost-saving","type:enhancement"]}
{"id":"beethoven-cfh","title":"Test Agent Memory Systems (Knowledge Base + Zep Student Memory)","description":"Test and verify that both memory systems in the Beethoven agent are working correctly:\n\n## Knowledge Base (RAG)\n- Test that the agent can retrieve relevant information from uploaded knowledge bases\n- Verify lesson content, vocabulary lists, grammar explanations are accessible\n- Test retrieval accuracy and relevance\n\n## Zep Memory (Student Memory)\n- Test that student conversation history is being stored\n- Verify the agent remembers previous interactions with specific students\n- Test personalization based on student history (struggles, preferences, progress)\n- Check that memory persists across sessions\n\n## Testing Approach\n- Run test conversations with the agent\n- Query Zep Cloud to verify memory storage\n- Test RAG retrieval from knowledge bases in Convex\n- Check the agent logs for memory/RAG usage\n- Document any issues found\n\n## Relevant Code\n- apps/agent/main.py (RAG retriever initialization, Zep setup)\n- apps/agent/src/utils/ (convex_client.py for knowledge base access)\n- convex/knowledgeBases.ts (knowledge base management)\n\n## Acceptance Criteria\n- [ ] Knowledge base retrieval returns relevant lesson content\n- [ ] Zep stores conversation history correctly\n- [ ] Agent demonstrates recall of previous student interactions\n- [ ] Memory persists across multiple sessions\n- [ ] All issues documented with reproduction steps","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T17:48:03.79613+01:00","created_by":"tomas","updated_at":"2026-01-04T17:48:03.79613+01:00","labels":["area:agent","scope:memory","type:testing"]}
{"id":"beethoven-eji","title":"Admin Dashboard Cleanup \u0026 Beta Release Preparation","description":"Prepare the Beethoven platform for beta release by cleaning up the admin dashboard and ensuring all core functionality works end-to-end.\n\n## Context\n- Current admin pages at app/(dashboard)/admin/ include: avatars, knowledge, lessons, games, tools\n- Design should remain consistent - this is polish, not redesign\n- Goal is a clean, functional admin experience for beta users\n- This task BLOCKS beta release\n\n## Acceptance Criteria\n\n### 1. Cleanup Redundant Pages\n- [ ] Audit all pages in app/(dashboard)/ and document unused/redundant pages\n- [ ] Remove duplicate or obsolete components\n- [ ] Clean up any test/placeholder pages\n- [ ] Consolidate similar functionality where appropriate\n\n### 2. Admin Dashboard Polish\n- [ ] Keep existing design language (no redesign)\n- [ ] Ensure consistent styling across all admin pages\n- [ ] Fix any broken links or navigation issues\n- [ ] Ensure all admin features are functional and accessible\n- [ ] Remove any debug/development UI elements\n\n### 3. Beta Release Readiness\n- [ ] Verify Lesson creation flow works end-to-end\n- [ ] Verify Avatar configuration flow works end-to-end\n- [ ] Verify Knowledge base management flow works end-to-end\n- [ ] Verify Session management flow works end-to-end\n- [ ] Remove any placeholder/mock data displays\n- [ ] Add appropriate loading states where missing\n- [ ] Add error handling where missing\n- [ ] Ensure mobile responsiveness where needed\n- [ ] Clean up console errors and warnings\n\n### 4. Code Quality\n- [ ] Remove unused imports and dead code\n- [ ] Fix TypeScript types (eliminate unnecessary 'any' types)\n- [ ] Clean up commented-out code\n- [ ] Ensure consistent naming conventions\n\n## Technical Notes\n\n### Files to Audit\n- app/(dashboard)/admin/page.tsx - Main admin page\n- app/(dashboard)/admin/avatars/page.tsx - Avatar management\n- app/(dashboard)/admin/knowledge/page.tsx - Knowledge base management\n- app/(dashboard)/admin/lessons/page.tsx - Lesson management\n- app/(dashboard)/admin/games/ - Games (new, may need review)\n- app/(dashboard)/admin/tools/ - Tools (new, may need review)\n- app/(dashboard)/admin/layout.tsx - Admin layout\n\n### Core Flows to Test\n1. **Lesson Creation**: Create lesson -\u003e Add slides -\u003e Configure settings -\u003e Save\n2. **Avatar Configuration**: Create avatar -\u003e Set voice/LLM config -\u003e Test\n3. **Knowledge Base**: Upload documents -\u003e Process -\u003e Associate with lessons\n4. **Session Management**: View sessions -\u003e Monitor status -\u003e Review transcripts\n\n### Scope Boundaries\n- NOT a redesign - keep existing visual style\n- Focus on functionality and cleanup, not new features\n- Mobile optimization is nice-to-have, not required for all views\n- Admin is internal tool, so performance optimization is secondary\n\n## Related Files (from git status)\nSeveral admin-related files show modifications:\n- app/(dashboard)/admin/avatars/page.tsx\n- app/(dashboard)/admin/knowledge/page.tsx\n- app/(dashboard)/admin/layout.tsx\n- app/(dashboard)/admin/lessons/page.tsx\n- app/(dashboard)/admin/page.tsx\n- New: app/(dashboard)/admin/games/\n- New: app/(dashboard)/admin/tools/","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-04T18:09:13.585837+01:00","created_by":"tomas","updated_at":"2026-01-04T18:09:13.585837+01:00","labels":["area:admin","area:frontend","beta-blocker","type:cleanup"]}
{"id":"beethoven-rb0","title":"Email Integration with Resend","description":"Set up email functionality for the Beethoven platform using Resend as the email provider.\n\n## Configuration\n- Email provider: Resend (https://resend.com/docs)\n- Sender email: james@simmonds.online\n- API key location: api-registry.json (add to RESEND_API_KEY env var)\n\n## Email Use Cases\n- Welcome emails for new users\n- Lesson assignment notifications\n- Course enrollment confirmations\n- Session reminders (scheduled lessons)\n- Progress reports/summaries\n- Password reset (if not handled by Clerk)\n- Shareable game/lesson link emails\n\n## Implementation Tasks\n\n### 1. Setup \u0026 Configuration\n- [ ] Install Resend SDK (`npm install resend`)\n- [ ] Add RESEND_API_KEY to environment variables\n- [ ] Create email utility/service in `lib/email.ts`\n\n### 2. API Routes\n- [ ] Create API route: `app/api/email/send/route.ts`\n- [ ] Add request validation and error handling\n- [ ] Implement rate limiting (optional)\n\n### 3. Email Templates (React Email or HTML)\n- [ ] Welcome email (new user registration)\n- [ ] Lesson assigned notification\n- [ ] Course enrollment confirmation\n- [ ] Session reminder (scheduled lesson)\n- [ ] Shareable link email (games/lessons)\n- [ ] Progress report summary\n\n### 4. Integration Points\n- [ ] Convex actions for triggering emails on events\n- [ ] Hook into Clerk webhooks for welcome emails\n- [ ] Connect to lesson/session creation flows\n- [ ] Admin UI for manual email sending (optional)\n\n## Technical Notes\n- Consider using React Email for type-safe, component-based templates\n- Resend supports React components directly for email rendering\n- Test emails in development with Resend's test mode\n- Add email sending to session reminders cron job (if exists)\n\n## Acceptance Criteria\n- [ ] Emails send successfully from james@simmonds.online\n- [ ] All core templates render correctly\n- [ ] Email sending is triggered on appropriate platform events\n- [ ] Error handling prevents silent failures\n- [ ] Email logs available for debugging","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T18:10:41.983221+01:00","created_by":"tomas","updated_at":"2026-01-04T18:10:41.983221+01:00","labels":["area:api","area:backend","provider:resend","type:integration"]}
{"id":"beethoven-xcs","title":"Shareable Game Links for Client Sessions","description":"## Summary\n\nAdd the ability to generate unique shareable links for games so teachers can invite students/clients to play games together in real-time. This enables collaborative/multiplayer gameplay between teacher and student over the web.\n\n## Background\n\nThe Beethoven platform already has a robust game system (components/games/) with multiple game types:\n- SentenceBuilder, FillInBlank, WordOrdering, MatchingPairs\n- WordScramble, MultipleChoice, Flashcards, Hangman, Crossword\n\nGames are stored in the `wordGames` table with individual play sessions tracked in `gameSessions`. However, the current implementation only supports single-player mode. This feature extends the system to support real-time multiplayer sessions via shareable links.\n\n## Requirements\n\n### 1. Unique Token Generation\n- Generate cryptographically secure tokens for game sessions\n- Tokens should be URL-safe and reasonably short (e.g., 12-16 chars)\n- Tokens must be indexed in database for fast lookup\n\n### 2. Shareable URL Structure\n- Create routes like `/games/play/[token]` for public game access\n- URLs should work without authentication for invited clients\n- Consider optional password protection for additional security\n\n### 3. Real-time Multiplayer State\n- Extend `gameSessions` table with multiplayer fields:\n  - `shareToken`: unique token for the link\n  - `hostUserId`: teacher/creator ID\n  - `participants`: array of connected participants\n  - `isMultiplayer`: boolean flag\n  - `sharedState`: synchronized game state object\n- Use Convex subscriptions for real-time state sync\n\n### 4. Game State Synchronization\n- Sync current question/card/item index across participants\n- Sync answers and progress\n- Handle turn-based vs concurrent gameplay modes\n- Implement conflict resolution for simultaneous actions\n\n### 5. UI for Link Generation\n- Add \"Share Game\" button in admin/games interface\n- Copy-to-clipboard functionality for the shareable URL\n- Show QR code option for easy mobile joining\n- Display list of active shared sessions\n\n### 6. Join Flow for Clients\n- Landing page at `/games/play/[token]`\n- Prompt for name/nickname if not authenticated\n- Display game waiting room until host starts\n- Show participant list in real-time\n\n## Technical Approach\n\n### Database Changes (convex/schema.ts)\n- Add `shareToken` field to `gameSessions` with unique index\n- Add `multiplayerSessions` table or extend `gameSessions` with:\n  - `hostUserId`, `participants`, `gameSettings`\n  - `status`: \"waiting\", \"active\", \"completed\"\n\n### New Convex Functions (convex/wordGames.ts)\n- `createShareableSession`: Generate token, create session\n- `joinSharedSession`: Add participant to session\n- `getSessionByToken`: Lookup by share token\n- `updateSharedGameState`: Sync state across participants\n- `leaveSession`, `endSharedSession`\n\n### Frontend Routes\n- `app/(public)/games/play/[token]/page.tsx` - Public join page\n- `app/(dashboard)/admin/games/[gameId]/share/page.tsx` - Share management\n\n### Components\n- `ShareGameDialog` - Modal with link generation UI\n- `GameWaitingRoom` - Pre-game lobby\n- `MultiplayerGameWrapper` - Real-time sync wrapper\n\n## Acceptance Criteria\n\n- [ ] Teacher can click \"Share\" on any published game\n- [ ] Unique shareable URL is generated and copyable\n- [ ] Client can open link and join without creating account\n- [ ] Teacher sees client join in real-time (participant list)\n- [ ] Game state syncs in real-time between all participants\n- [ ] Game works across all supported game types\n- [ ] Host can end/close the shared session\n- [ ] Tokens expire or can be manually revoked\n- [ ] Session state persists if client briefly disconnects\n- [ ] Works on mobile browsers\n\n## Out of Scope (for initial version)\n\n- Voice/video chat integration (use LiveKit separately)\n- Score leaderboards between multiple students\n- Game tournaments/competitions\n- Replay/recording functionality\n- Anonymous/guest host creation\n\n## Related Files\n\n- `/Users/tomas/apps/beethoven/convex/wordGames.ts` - Game queries/mutations\n- `/Users/tomas/apps/beethoven/convex/schema.ts` - Database schema (lines 1127-1300)\n- `/Users/tomas/apps/beethoven/components/games/` - All game components\n- `/Users/tomas/apps/beethoven/app/(dashboard)/admin/games/` - Admin game pages\n\n## Estimated Effort\n\nMedium complexity - 2-3 days\n- Schema changes: 2-3 hours\n- Convex functions: 4-6 hours\n- Frontend routes/components: 8-12 hours\n- Testing multiplayer sync: 4-6 hours","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T17:47:03.769565+01:00","created_by":"tomas","updated_at":"2026-01-04T17:47:03.769565+01:00","labels":["area:convex","area:frontend","area:games","multiplayer","type:feature"]}
