{"id":"beethoven-78q","title":"Feature: Audio-Only Lesson Mode - Add option to run lessons with audio only (no avatar video)","description":"## Summary\n\nAdd an explicit 'audioOnly' mode for lessons that uses TTS audio with a static avatar image instead of rendering the Beyond Presence video avatar. This mode can be selected when creating lessons to:\n- Save on Beyond Presence API costs\n- Work when avatar video quota is exceeded\n- Provide a lighter-weight lesson experience\n\n## Background\n\nThe Python agent already has audio-only fallback code (lines 1284-1447 in apps/agent/main.py) that activates when Beyond Presence fails (quota exceeded, auth error, rate limited, etc.). This feature request is to make audio-only mode an intentional, configurable option rather than just a fallback.\n\n## Implementation Tasks\n\n### 1. Schema Updates (convex/schema.ts)\n- Add `audioOnly: v.optional(v.boolean())` to `structuredLessons` table\n- Add `audioOnly: v.optional(v.boolean())` to `sessions` table\n\n### 2. Session Creation Updates (convex/sessions.ts)\n- Modify `createFromStructuredLesson` to pass through `audioOnly` flag to session\n- Ensure `createSession` accepts optional `audioOnly` parameter\n\n### 3. Admin UI Updates (app/(dashboard)/admin/lessons/page.tsx or related)\n- Add toggle/checkbox for \"Audio Only Mode\" when creating a structured lesson\n- Include tooltip explaining: \"Uses TTS audio with static avatar image instead of video avatar. Saves API costs.\"\n\n### 4. Frontend Lesson Room Updates\n- Modify lesson room component to check session.audioOnly flag\n- When audioOnly=true:\n  - Display static avatar image (from avatar.appearance.avatarImage) instead of video track\n  - Hide/disable avatar video track subscription\n  - TTS audio still plays normally\n- Reference existing components:\n  - components/lesson/lesson-room.tsx\n  - components/lesson/teaching-room.tsx\n\n### 5. Python Agent Updates (apps/agent/main.py)\n- Read `audioOnly` flag from session data (fetched via Convex client)\n- When audioOnly=true:\n  - Skip Beyond Presence avatar initialization entirely (don't even attempt)\n  - Set `audio_only_mode = True` at the start\n  - Use existing audio-only code path\n- This avoids wasting API calls and reduces startup latency\n\n## Acceptance Criteria\n\n- [ ] Admin can toggle \"Audio Only\" when creating a structured lesson\n- [ ] When audioOnly lesson is started, frontend shows static avatar image\n- [ ] TTS audio plays normally in audioOnly mode\n- [ ] Python agent skips avatar video initialization for audioOnly sessions\n- [ ] Existing fallback behavior still works when avatar fails unexpectedly\n- [ ] No regression to normal avatar video lessons\n\n## Technical Notes\n\n- Avatar static images are stored in `avatar.appearance.avatarImage` field\n- The existing `audio_only_mode` variable in main.py should be set based on session config\n- Session data is already fetched via ConvexClient in the agent\n- Consider adding visual indicator in lesson UI showing \"Audio Only Mode\" to student\n\n## Related Files\n\n- `/Users/tomas/apps/beethoven/convex/schema.ts` - Database schema\n- `/Users/tomas/apps/beethoven/convex/sessions.ts` - Session mutations/queries\n- `/Users/tomas/apps/beethoven/apps/agent/main.py` - Python agent (lines 1284-1447 for existing fallback)\n- `/Users/tomas/apps/beethoven/components/lesson/lesson-room.tsx` - Frontend lesson UI\n- `/Users/tomas/apps/beethoven/components/lesson/teaching-room.tsx` - Teaching room component\n\n## Out of Scope\n\n- Automatic switching between video and audio-only based on quota\n- Per-session toggle (only per-lesson configuration for now)\n- Audio-only for quick practice or free conversation (only structured lessons)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T17:43:48.668012+01:00","created_by":"tomas","updated_at":"2026-01-04T17:43:48.668012+01:00","labels":["area:agent","area:frontend","area:lessons","cost-saving","type:enhancement"]}
